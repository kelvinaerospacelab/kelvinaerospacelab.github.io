{{ define "main" }}
  {{- partial "menu.html" . -}}
  
  <style>
    /* SpaceX-style fullscreen update cards */
    .update-fullscreen-card {
      height: 100vh;
      width: 100%;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    
    .update-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    
    .update-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 2;
    }
    
    .update-content {
      position: relative;
      z-index: 3;
      text-align: left;
      color: white;
      max-width: 600px;
      padding: 2rem;
      margin-left: 8%;
    }
    
    .update-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.8rem;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      line-height: 1.2;
    }
    
    .update-date {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 1rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }
    
    .update-summary {
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
      text-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .update-button {
      display: inline-block;
      padding: 0.75rem 2rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: white;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid white;
      border-radius: 4px;
      text-decoration: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    .update-button:hover {
      background: white;
      color: #333;
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    /* Scroll down indicator */
    .scroll-indicator {
      position: fixed;
      bottom: 40px;
      right: 40px;
      z-index: 1000;
      color: white;
      font-size: 2rem;
      animation: bounce 2s infinite;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }
    
    .scroll-indicator:hover {
      opacity: 1;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }
    
    /* Hide menu on scroll down - Updates page specific */
    body.updates #menu {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      transition: transform 0.3s ease !important;
      z-index: 999 !important;
    }
    
    body.updates #menu.menu-hidden {
      transform: translateY(-100%) !important;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .update-title {
        font-size: 2rem;
      }
      
      .update-summary {
        font-size: 0.9rem;
        -webkit-line-clamp: 2;
      }
      
      .update-content {
        padding: 1.5rem;
        margin-left: 5%;
        max-width: 90%;
      }
      
      .scroll-indicator {
        bottom: 20px;
        right: 20px;
        font-size: 1.5rem;
      }
    }
  </style>
  
  <div>
    {{ range (where .Pages "Draft" false).ByDate.Reverse }}
    <section class="update-fullscreen-card">
      {{ $featuredImage := "" }}
      
      {{ if .Params.featured_image }}
        {{ $featuredImage = .Params.featured_image }}
      {{ else }}
        {{ $images := findRE "<img.*?src=\"(.*?)\"" .Content 1 }}
        {{ if $images }}
          {{ $firstImg := index $images 0 }}
          {{ $srcMatch := findRE "src=\"([^\"]+)\"" $firstImg 1 }}
          {{ if $srcMatch }}
            {{ $featuredImage = replaceRE "src=\"([^\"]+)\"" "$1" (index $srcMatch 0) }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if not $featuredImage }}
        {{ $randomImages := slice 
          "/images/updates-random/GSFC_20171208_Archive_e000842~large.jpg"
          "/images/updates-random/PIA26077~orig.jpg"
          "/images/updates-random/S84-27031~large.jpg"
          "/images/updates-random/carina_nebula~orig.png"
          "/images/updates-random/iss064e041512~large.jpg"
          "/images/updates-random/iss073e0659744~large.jpg"
        }}
        {{ $seed := add (len .Title) (.Date.Day) }}
        {{ $index := mod $seed (len $randomImages) }}
        {{ $featuredImage = index $randomImages $index }}
      {{ end }}
      
      <img src="{{ $featuredImage | relURL }}" alt="{{ .Title }}" class="update-background">
      
      <div class="update-overlay" style="{{ if .Params.overlay_color }}background: {{ .Params.overlay_color }};{{ end }}"></div>
      
      <div class="update-content" style="{{ if .Params.text_color }}color: {{ .Params.text_color }};{{ end }}">
        <h1 class="update-title">{{ .Title }}</h1>
        <p class="update-date">{{ .Date.Format "January 2, 2006" }}</p>
        <p class="update-summary">
          {{ if .Params.summary }}
            {{ .Params.summary }}
          {{ else }}
            {{ .Summary | plainify | truncate 200 }}
          {{ end }}
        </p>
        <a href="{{ .RelPermalink }}" class="update-button" style="{{ if .Params.button_style }}{{ .Params.button_style }}{{ end }}">
          {{ if .Params.button_text }}{{ .Params.button_text }}{{ else }}Read More{{ end }}
        </a>
      </div>
    </section>
    {{ end }}
  </div>
  
  <!-- Scroll down indicator -->
  <div class="scroll-indicator" id="scrollIndicator">
    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </div>
  
  <script>
    (function() {
      const menu = document.getElementById('menu');
      const scrollIndicator = document.getElementById('scrollIndicator');
      let lastScrollTop = 0;
      let ticking = false;
      let isHiding = false;
      
      if (!menu) return;
      
      // Force initial styles with setProperty for !important
      menu.style.setProperty('position', 'fixed', 'important');
      menu.style.setProperty('width', '100%', 'important');
      menu.style.setProperty('z-index', '999', 'important');
      menu.style.setProperty('top', '0', 'important');
      menu.style.setProperty('opacity', '1', 'important');
      menu.style.setProperty('transition', 'top 1s cubic-bezier(0.4, 0, 0.2, 1), opacity 1s cubic-bezier(0.4, 0, 0.2, 1)', 'important');
      
      function updateMenuVisibility() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Hide/show menu based on scroll direction
        if (scrollTop > lastScrollTop && scrollTop > 100) {
          // Scrolling down - hide menu
          if (!isHiding) {
            menu.style.setProperty('top', '-100px', 'important');
            menu.style.setProperty('opacity', '0', 'important');
            isHiding = true;
          }
        } else if (scrollTop < lastScrollTop) {
          // Scrolling up - show menu
          if (isHiding) {
            menu.style.setProperty('top', '0', 'important');
            menu.style.setProperty('opacity', '1', 'important');
            isHiding = false;
          }
        }
        
        // Reset at top
        if (scrollTop <= 10) {
          menu.style.setProperty('top', '0', 'important');
          menu.style.setProperty('opacity', '1', 'important');
          isHiding = false;
        }
        
        // Hide scroll indicator after scrolling
        if (scrollIndicator) {
          if (scrollTop > 200) {
            scrollIndicator.style.opacity = '0';
            scrollIndicator.style.pointerEvents = 'none';
          } else {
            scrollIndicator.style.opacity = '0.8';
            scrollIndicator.style.pointerEvents = 'auto';
          }
        }
        
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
      }
      
      // Scroll event with throttling
      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            updateMenuVisibility();
            ticking = false;
          });
          ticking = true;
        }
      }, { passive: true });
      
      // Click scroll indicator to scroll down one viewport
      if (scrollIndicator) {
        scrollIndicator.addEventListener('click', function() {
          window.scrollBy({
            top: window.innerHeight,
            behavior: 'smooth'
          });
        });
      }
    })();
  </script>
  
{{ end }}
